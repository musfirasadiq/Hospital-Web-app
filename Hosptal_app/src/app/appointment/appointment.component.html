<div class="container mt-4">
  <div class="card appointment-form-card">
    <div class="card-header">
      <h5>{{ isEditing ? 'Edit Appointment' : 'Add New Appointment' }}</h5>
    </div>
    <div class="card-body">
      <form (ngSubmit)="bookAppointment()" #appointmentForm="ngForm">
        <!-- Patient Selection -->
        <div class="mb-3">
          <label for="patientSelect" class="form-label">Select Patient *</label>
          <select
            id="patientSelect"
            class="form-select"
            [(ngModel)]="selectedPatientId"
            name="selectedPatientId"
            required>
            <option value="" disabled>Select a patient</option>
            <option *ngFor="let patient of patients" [value]="patient._id">
              {{ patient.name }}
            </option>
          </select>
        </div>

        <!-- Doctor Selection -->
        <div class="mb-3">
          <label for="doctorSelect" class="form-label">Select Doctor *</label>
          <select
            id="doctorSelect"
            class="form-select"
            [(ngModel)]="selectedDoctorId"
            name="selectedDoctorId"
            required>
            <option value="" disabled>Select a doctor</option>
            <option *ngFor="let doctor of doctors" [value]="doctor._id">
              {{ doctor.name }}
            </option>
          </select>
        </div>

        <div class="mb-3">
          <label for="appointmentDate" class="form-label">Appointment Date *</label>
          <input
            type="date"
            class="form-control"
            id="appointmentDate"
            [(ngModel)]="appointmentDate"
            name="appointmentDate"
            required />
          <div class="text-danger" *ngIf="appointmentForm.controls['appointmentDate']?.invalid">Please select a date</div>
        </div>

        <div class="mb-3">
          <label for="appointmentTime" class="form-label">Appointment Time *</label>
          <input
            type="text"
            class="form-control"
            id="appointmentTime"
            [(ngModel)]="appointmentTime"
            name="appointmentTime"
            required
            placeholder="e.g., 10:30 AM"
            (ngModelChange)="validateTime(appointmentTime)" />
          <div class="text-danger" *ngIf="errorMessage">Invalid time format. Use hh:mm AM/PM.</div>
        </div>

        <button class="btn btn-primary" type="submit" [disabled]="!appointmentForm.valid">
          {{ isEditing ? 'Update' : 'Add' }}
        </button>

        <div class="mt-3" *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
        <div class="mt-3" *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
      </form>
    </div>
  </div>
</div>

<div class="container mt-4">
  <div class="card appointment-list-card">
    <div class="card-header">
      <h5>Appointments ({{ appointments.length }})</h5>
    </div>
    <div class="card-body" *ngIf="appointments.length; else noAppointments">
      <div *ngFor="let appointment of appointments" class="mb-3">
        <div class="card appointment-detail-card">
          <div class="card-body">
            <p><strong>Patient:</strong> {{ appointment.patientId.name || 'Unknown Patient' }}</p>
            <p><strong>Doctor:</strong> {{ appointment.doctorId.name || 'Unknown Doctor' }}</p>
            <p><strong>Date:</strong> {{ appointment.appointmentDate | date }}</p>
            <p><strong>Time:</strong> {{ appointment.appointmentTime }}</p>
          </div>
          <div class="card-footer">
            <button class="btn btn-primary" (click)="editAppointment(appointment)">Edit</button>
            <button class="btn btn-danger" (click)="deleteAppointment(appointment._id)">Delete</button>
          </div>
        </div>
      </div>
    </div>
    <ng-template #noAppointments>
      <div class="alert alert-warning">No appointments available.</div>
    </ng-template>
  </div>
</div>
